function update_progress_bar(){progress_interval=window.setInterval(function(){var a=$video.tubeplayer("data").currentTime/$video.tubeplayer("data").duration;$("#progressBar .elapsed").width(Math.round(a*$("#progressBar").outerWidth())+"px")},1e3)}function video_queue(a,b){var c=b||"",d='<li id="video_'+a+'" class="track" style="background-image: url(http://i.ytimg.com/vi/'+a+'/2.jpg)">';d+='<a class="title" href="#'+a+'">'+c+"</a>";d+='<a class="remove" href="#">x</a>';d+="</li>";$("#playlist").append(d);videos.push(a)}function video_remove(a){$("#video_"+a).remove();videos=$.grep(videos,function(b){return b!=a})}function video_set_active(a){var b=a||videos[videos_index];videos_index=$.inArray(b,videos);$("#playlist li").removeClass("active");$("#video_"+b).addClass("active");var c=$("#video_"+b+" .title").text();$("h1").text(c);document.title=c+" | MusicPond"}function vp_skip(){$.post("playlist.php",{action:"play"})}function sync(){window.clearTimeout(sync_timeout);var a=(new Date).getTime();$.get("sync.php",function(b){if(typeof b.added=="string"||typeof b.added=="object"){var c=[];b.added.video_id!==null?c.push(b.added):c=b.added;$.each(c,function(a,b){video_queue(b.video_id,b.title)})}typeof b.removed=="object"&&$.each(b.removed,function(a,b){video_remove(b.video_id)});if(b.playing&&b.playing.video_id!==videos[videos_index]&&$video.tubeplayer("data").videoID!==b.playing.video_id){var d=Math.ceil((a-b.playing.time*1e3)/1e3);now_playing.startSeconds=d;$video.tubeplayer("play",{id:b.playing.video_id,time:d})}var e=Math.floor(a/1e3)*1e3,f=sync_period-(a-e);sync_timeout=window.setTimeout(sync,f)},"json")}function video_id_from_string(a){return a.match(/v=(.{11})/)[1]}(function(a){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)})}var b=".tubeplayer",c="jquery-youtube-tubeplayer",d="opts"+b,e={};e.ytplayers={};e.inits=[];e.iframeScriptInited=!1;e.inited=!1;a.tubeplayer={};a.tubeplayer.TubePlayer=e;a.tubeplayer.events={};a.tubeplayer.defaults={afterReady:function(a){},stateChange:function(a){var b=this.onPlayer;return function(c){typeof c=="object"&&(c=c.data);switch(c){case-1:return b.unstarted[a]();case 0:return b.ended[a]();case 1:return b.playing[a]();case 2:return b.paused[a]();case 3:return b.buffering[a]();case 5:return b.cued[a]();default:return null}}},onError:function(a){var b=this.onErr;return function(c){typeof c=="object"&&(c=c.data);switch(c){case 2:return b.invalidParameter[a]();case 100:return b.notFound[a]();case 101:case 150:return b.notEmbeddable[a]();default:return null}}},qualityChange:function(a){var b=this;return function(c){typeof c=="object"&&(c=c.data);return b.onQualityChange[a](c)}},onQualityChange:{},onPlayer:{unstarted:{},ended:{},playing:{},paused:{},buffering:{},cued:{}},onErr:{notFound:{},notEmbeddable:{},invalidParameter:{}}};var f={width:425,height:355,allowFullScreen:"true",initialVideo:"DkoeNLuMbcI",start:0,preferredQuality:"default",showControls:!0,showRelated:!1,annotations:!0,autoPlay:!1,autoHide:!0,loop:0,theme:"dark",color:"red",showinfo:!1,modestbranding:!0,protocol:"http",wmode:"transparent",swfobjectURL:"ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js",loadSWFObject:!0,allowScriptAccess:"always",playerID:"tubeplayer-player-container",iframed:!0,onPlay:function(a){},onPause:function(){},onStop:function(){},onSeek:function(a){},onMute:function(){},onUnMute:function(){},onPlayerUnstarted:function(){},onPlayerEnded:function(){},onPlayerPlaying:function(){},onPlayerPaused:function(){},onPlayerBuffering:function(){},onPlayerCued:function(){},onQualityChange:function(){},onErrorNotFound:function(){},onErrorNotEmbeddable:function(){},onErrorInvalidParameter:function(){}};a.fn.tubeplayer=function(c,d){var f=a(this),g=typeof c;if(arguments.length===0||g==="object")return f.each(function(){e.init(a(this),c)});if(g==="string")return f.triggerHandler(c+b,d||null)};var g=function(a,b){return function(b,c){var d=e.getPkg(b);if(d.ytplayer){var f=a(b,c,d);typeof f=="undefined"&&(f=d.$player);return f}return d.$player}};a.tubeplayer.getPlayers=function(){return e.ytplayers};e.init=function(g,j){if(g.hasClass(c))return g;var k=a.extend({},f,j);k.playerID+="-"+i();g.addClass(c).data(d,k);for(var l in h)g.bind(l+b,g,h[l]);e.initDefaults(a.tubeplayer.defaults,k);a("<div></div>").attr("id",k.playerID).appendTo(g);e.initPlayer(g,k);return g};e.getPkg=function(a){var b=a.data,c=b.data(d),f=e.ytplayers[c.playerID];return{$player:b,opts:c,ytplayer:f}};e.iframeReady=function(b){e.inits.push(function(){new YT.Player(b.playerID,{videoId:b.initialVideo,width:b.width,height:b.height,playerVars:{autoplay:b.autoPlay?1:0,autohide:b.autoHide?1:0,controls:b.showControls?1:0,loop:b.loop?1:0,playlist:b.loop?b.initialVideo:"",rel:b.showRelated?1:0,fs:b.allowFullScreen?1:0,wmode:b.wmode,showinfo:b.showinfo?1:0,modestbranding:b.modestbranding?1:0,iv_load_policy:b.annotations?1:3,start:b.start,theme:b.theme,color:b.color},events:{onReady:function(d){e.ytplayers[b.playerID]=d.target;var f=a(d.target).parents("."+c);a.tubeplayer.defaults.afterReady(f)},onPlaybackQualityChange:a.tubeplayer.defaults.qualityChange(b.playerID),onStateChange:a.tubeplayer.defaults.stateChange(b.playerID),onError:a.tubeplayer.defaults.onError(b.playerID)}})});if(e.inits.length>=1&&!e.inited)return function(){for(var a=0;a<e.inits.length;a++)e.inits[a]();e.inited=!0};e.inited&&e.inits.pop()();return window.onYouTubePlayerAPIReady};e.supportsHTML5=function(){return!!document.createElement("video").canPlayType};e.initDefaults=function(a,b){var c=b.playerID,d=a.onPlayer;d.unstarted[c]=b.onPlayerUnstarted;d.ended[c]=b.onPlayerEnded;d.playing[c]=b.onPlayerPlaying;d.paused[c]=b.onPlayerPaused;d.buffering[c]=b.onPlayerBuffering;d.cued[c]=b.onPlayerCued;a.onQualityChange[c]=b.onQualityChange;var e=a.onErr;e.notFound[c]=b.onErrorNotFound;e.notEmbeddable[c]=b.onErrorNotEmbeddable;e.invalidParameter[c]=b.onErrorInvalidParameter};e.initPlayer=function(a,b){b.iframed&&e.supportsHTML5()?e.initIframePlayer(a,b):e.initFlashPlayer(a,b)};e.initIframePlayer=function(a,b){if(!e.iframeScriptInited){var c=document.createElement("script");c.src=b.protocol+"://www.youtube.com/iframe_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);e.iframeScriptInited=!0}window.onYouTubePlayerAPIReady=e.iframeReady(b)};e.initFlashPlayer=function(b,c){if(c.loadSWFObject){c.swfobjectURL=c.swfobjectURL.replace("http://","");c.swfobjectURL=c.swfobjectURL.replace("https://","");c.swfobjectURL=c.protocol+"://"+c.swfobjectURL;a.getScript(c.swfobjectURL,e.initFlashPlayerFN(c))}else e.initFlashPlayerFN(c)()};e.initFlashPlayerFN=function(b){return function(){var d=["//www.youtube.com/v/"];d.push(b.initialVideo);d.push("?&enablejsapi=1&version=3");d.push("&playerapiid="+b.playerID);d.push("&rel= "+(b.showRelated?1:0));d.push("&autoplay="+(b.autoPlay?1:0));d.push("&autohide="+(b.autoHide?1:0));d.push("&loop="+(b.loop?1:0));d.push("&playlist="+(b.loop?b.initialVideo:""));d.push("&controls="+(b.showControls?1:0));d.push("&showinfo="+(b.showinfo?1:0));d.push("&modestbranding="+(b.modestbranding?1:0));d.push("&iv_load_policy="+(b.annotations?1:3));d.push("&start="+b.start);d.push("&theme="+b.theme);d.push("&color="+b.color);d.push("&fs="+(b.allowFullScreen?1:0));swfobject.embedSWF(d.join(""),b.playerID,b.width,b.height,"8",null,null,{allowScriptAccess:b.allowScriptAccess,wmode:b.wmode,allowFullScreen:b.allowFullScreen},{id:b.playerID});window.onYouTubePlayerReady=function(b){var d=document.getElementById(b),f=b.replace(/-/g,""),g=a.tubeplayer.defaults;a.tubeplayer.events[f]={stateChange:g.stateChange(b),error:g.onError(b),qualityChange:g.qualityChange(b)};d.addEventListener("onStateChange","$.tubeplayer.events."+f+".stateChange");d.addEventListener("onError","$.tubeplayer.events."+f+".error");d.addEventListener("onPlaybackQualityChange","$.tubeplayer.events."+f+".qualityChange");e.ytplayers[b]=d;var h=a(d).parents("."+c);a.tubeplayer.defaults.afterReady(h)}}};e.getVideoIDFromURL=function(a){a=a||"";var b=a.indexOf("?"),c=a.substring(b,a.length),d=c.indexOf("v=");if(d>-1){var e=c.indexOf("&",d);e===-1&&(e=c.length);return c.substring(d+"v=".length,e)}return""};var h={cue:g(function(a,b,c){c.ytplayer.cueVideoById(b,c.opts.preferredQuality)}),play:g(function(a,b,c){typeof b=="object"?c.ytplayer.loadVideoById(b.id,b.time,c.opts.preferredQuality):b?c.ytplayer.loadVideoById(b,0,c.opts.preferredQuality):c.ytplayer.playVideo();c.opts.onPlay(b)}),pause:g(function(a,b,c){c.ytplayer.pauseVideo();c.opts.onPause(c)}),stop:g(function(a,b,c){c.ytplayer.stopVideo();c.opts.onStop(c)}),seek:g(function(a,b,c){c.ytplayer.seekTo(b,!0);c.opts.onSeek(b)}),mute:g(function(a,b,c){c.$player.attr("data-prev-mute-volume",c.ytplayer.getVolume());c.ytplayer.mute();c.opts.onMute(c)}),unmute:g(function(a,b,c){c.ytplayer.unMute();c.ytplayer.setVolume(c.$player.attr("data-prev-mute-volume")||50);c.opts.onUnMute()}),isMuted:g(function(a,b,c){return c.ytplayer.isMuted()}),volume:g(function(a,b,c){if(!b)return c.ytplayer.getVolume()||0;c.ytplayer.setVolume(b);c.$player.attr("data-prev-mute-volume",c.ytplayer.getVolume())}),quality:g(function(a,b,c){if(!b)return c.ytplayer.getPlaybackQuality();c.ytplayer.setPlaybackQuality(b)}),data:g(function(a,b,c){var d={},f=c.ytplayer;d.bytesLoaded=f.getVideoBytesLoaded();d.bytesTotal=f.getVideoBytesTotal();d.startBytes=f.getVideoStartBytes();d.state=f.getPlayerState();d.currentTime=f.getCurrentTime();d.duration=f.getDuration();d.videoURL=f.getVideoUrl();d.getVideoEmbedCode=f.getVideoEmbedCode();d.videoID=e.getVideoIDFromURL(d.videoURL);d.availableQualityLevels=f.getAvailableQualityLevels();return d}),videoId:g(function(a,b,c){return e.getVideoIDFromURL(c.ytplayer.getVideoUrl())}),size:g(function(b,c,d){if(c.width&&c.height){d.ytplayer.setSize(c.width,c.height);a(d.ytplayer).css(c)}}),destroy:g(function(f,g,h){h.$player.removeClass(c).data(d,null).unbind(b).html("");delete e.ytplayers[h.opts.playerID];var i=a.tubeplayer.defaults,j=["unstarted","ended","playing","paused","buffering","cued"];for(var k in j)delete i.onPlayer[j[k]][h.opts.playerID];j=["notFound","notEmbeddable","invalidParameter"];for(var k in j)delete i.onErr[j[k]][h.opts.playerID];delete i.onQualityChange[h.opts.playerID];delete a.tubeplayer.events[h.opts.playerID];a(h.ytplayer).remove();return null}),player:g(function(a,b,c){return c.ytplayer})}})(jQuery);var videos=[],videos_index=0,now_playing={startSeconds:0},progress_interval,sync_timeout,sync_period=2e3;$.tubeplayer.defaults.afterReady=function(a){sync();update_progress_bar()};var $video;$(document).ready(function(){"use strict";$video=$("#videoFrame");$video.tubeplayer({allowFullScreen:"true",height:"100%",initialVideo:"qPTyy4itI",modestbranding:!1,showControls:0,start:0,wmode:"opaque",width:"100%",onMute:function(){$("#mute").removeClass("inactive")},onUnMute:function(){$("#mute").addClass("inactive")},onSeek:function(a){update_progress_bar()},onPlayerEnded:function(){vp_skip()},onPlayerPlaying:function(){video_set_active($video.tubeplayer("data").videoID)},onErrorNotFound:function(){alert("Sorry, couldn't find your video. Try another one.")},onErrorNotEmbeddable:function(){alert("Sorry, this video can't be embedded. Try another one.")},onErrorInvalidParameter:function(){alert("Sorry, something went AWOL...")}});$("#progressBar").click(function(a){var b=$("#progressBar"),c=(a.pageX-b.offset().left)/b.outerWidth();$("#progressBar .elapsed").width(Math.round(c*b.outerWidth())+"px");$video.tubePlayer("seek",Math.round($video.tubeplayer("data").duration*c),!0);return!1});$.get("playlist.php",function(a){$.each(a,function(a,b){video_queue(b.video_id,b.title)})},"json");$("#play_btn").click(function(){$.post("playlist.php",{action:"play"})});$("#mute").click(function(){$video.tubeplayer("volume")<1?$video.tubeplayer("unmute"):$video.tubeplayer("mute")});$("#add-video").submit(function(){var a=$("#videoNew").val();a=video_id_from_string(a);$.post("playlist.php",{action:"add",video:a},function(a){$("#videoNew").val("")},"json");return!1});$(".title").live("click",function(){var a=$(this).parents("li").attr("id");a=a.replace("video_","");$.post("playlist.php",{action:"play",video:a},function(a){},"json");return!1});$(".remove").live("click",function(){var a=$(this).parents("li").attr("id");a=a.replace("video_","");$.post("playlist.php",{action:"remove",video:a},function(){video_remove(a)});return!1})});